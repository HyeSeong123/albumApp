<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>테스트</title>
  <link rel="stylesheet" href="../resources/css/stPageFlip.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100vh;
      background-color: #f9f7f4;
    }
    #flipbook {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    .page {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .page-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 10px;
      width: 90%;
      height: 90%;
      padding: 1rem;
      box-sizing: border-box;
    }
    .photo-wrapper {
      position: relative;
      border-radius: 0.75rem;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .photo-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .overlay {
      position: absolute;
      bottom: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.4);
      color: white;
      padding: 4px 8px;
      font-size: 12px;
      backdrop-filter: blur(2px);
    }
  </style>
</head>
<body>
  <div id="flipbook" class="w-[1280px] h-[960px] rounded-xl border bg-[#fefcf9] shadow-lg overflow-hidden">
    <div class="absolute inset-x-1/2 top-0 bottom-0 w-[2px] bg-gradient-to-b from-[#d3cfc7] to-[#e6e2da] opacity-50 pointer-events-none z-10"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/page-flip@0.4.3/dist/js/page-flip.browser.min.js"></script>
  <script>
    const images = Array.from({ length: 24 }, (_, i) => ({
      url: `https://picsum.photos/300/200?random=${i + 1}`,
      date: `2024-06-${String((15 + i % 2)).padStart(2, '0')}`,
      keywords: ['#여행', '#가족', '#생일', '#풍경'][i % 4]
    }));

    const container = document.getElementById('flipbook');

    const pageFlip = new St.PageFlip(container, {
      width: 640,
      height: 960,
      size: 'fixed',
      minWidth: 640,
      minHeight: 960,
      showCover: true,
      useMouseEvents: true,
      usePortrait: false,
      autoSize: false,
      animationSpeed: 700
    });

    const createImage = (src) => {
      return new Promise(resolve => {
        const img = new Image();
        img.src = src;
        img.onload = () => resolve(img);
      });
    };

    const createPhotoBox = async ({ url, date, keywords }) => {
      const wrapper = document.createElement('div');
      wrapper.className = 'photo-wrapper';
      const img = await createImage(url);
      wrapper.appendChild(img);

      const overlay = document.createElement('div');
      overlay.className = 'overlay';
      overlay.textContent = `${date} ${keywords}`;
      wrapper.appendChild(overlay);
      return wrapper;
    };

    const createPage = async (imgList) => {
      const page = document.createElement('div');
      page.className = 'page bg-[#fffaf5]';
      const grid = document.createElement('div');
      grid.className = 'page-grid';
      for (const img of imgList) {
        const box = await createPhotoBox(img);
        grid.appendChild(box);
      }
      page.appendChild(grid);
      return page;
    };

    (async () => {
      const pages = [];

      const cover = document.createElement('div');
      cover.className = 'page flex items-center justify-center bg-[#fdf8f1]';
      cover.setAttribute('data-density', 'hard');
      cover.innerHTML = `<h1 class="text-4xl font-bold text-gray-700 font-[cursive]">2024</h1>`;
      pages.push(cover);

      for (let i = 0; i < images.length; i += 12) {
        const group = images.slice(i, i + 12);
        const leftPage = await createPage(group.slice(0, 6));
        const rightPage = await createPage(group.slice(6, 12));
        pages.push(leftPage, rightPage);
      }

      if (pages.length % 2 === 0) {
        const filler = document.createElement('div');
        filler.className = 'page bg-[#fffaf5]';
        pages.push(filler);
      }

      pages.forEach(p => container.appendChild(p));
      pageFlip.loadFromHTML(pages);
    })();
  </script>
</body>
</html>
